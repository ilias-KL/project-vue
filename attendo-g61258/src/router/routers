// Import Vue Router functions
import { createRouter, createWebHistory } from 'vue-router'
// Import view components
import Accueil from '../views/AccueilView.vue'       // Home view
import Sessions from '../views/SessionView.vue'      // Sessions view
import APropos from '../views/AProposView.vue'      // About view
// Import Supabase client for authentication
import { supabase } from '../lib/supabase'

/**
 * Route configuration array
 * Defines all application routes and their components
 */
const routes = [
  // Public route - Home page
  { 
    path: '/', 
    component: Accueil 
  },
  
  // Protected route - Sessions page
  {
    path: '/sessions',
    component: Sessions,
    /**
     * Route guard to check authentication before entering
     * @param {Route} to - Target route object
     * @param {Route} from - Source route object
     * @param {Function} next - Callback to continue navigation
     */
    beforeEnter: async (to, from, next) => {
      try {
        // Check if user is authenticated
        const { data: { user } } = await supabase.auth.getUser()
        
        if (user) {
          // User is authenticated, proceed to route
          next()
        } else {
          // User not authenticated, redirect to home
          next('/')
        }
      } catch (error) {
        console.error('Authentication check failed:', error)
        // On error, redirect to home as fallback
        next('/')
      }
    }
  },
  
  // Public route - About page
  { 
    path: '/a-propos', 
    component: APropos 
  },
]

/**
 * Create and configure the Vue Router instance
 */
const router = createRouter({
  // Use HTML5 history mode for clean URLs (no hash)
  history: createWebHistory(),
  // Register all routes
  routes,
})

// Export the configured router instance
export default router